#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "streamforce"

require "active_support/tagged_logging"

tagged_logger = ActiveSupport::TaggedLogging.new(Logger.new($stdout))

client = Streamforce::Client.new logger: tagged_logger.tagged("Streamforce")
subscriptions = ENV["SALESFORCE_SUBSCRIPTIONS"].split(",")

client.subscribe(subscriptions) do |subscription, message|
  tagged_logger.tagged("Client", subscription).info "#{message.inspect}"
end
